# Механизм блокировок

>Цель:  
>понимать как работает механизм блокировок объектов и строк  

>Настройте сервер так, чтобы в журнал сообщений сбрасывалась информация о блокировках, удерживаемых более 200 миллисекунд. 

alter system set log_lock_waits = on
alter system set deadlock_timeout = 200
select pg_reload_conf();
>Воспроизведите ситуацию, при которой в журнале появятся такие сообщения.

create table t1 (id int, text text);
insert into t1 (1,'text1'), (2,'text2'), (3,'text3');
begin;
insert into t1 (4,'text4');
pg_sleep (1);
commit;

>Смоделируйте ситуацию обновления одной и той же строки тремя командами UPDATE в разных сеансах.   
>Изучите возникшие блокировки в представлении pg_locks и убедитесь, что все они понятны.   
>Пришлите список блокировок и объясните, что значит каждая.  
>Воспроизведите взаимоблокировку трех транзакций.   
>Можно ли разобраться в ситуации постфактум, изучая журнал сообщений?  
>Могут ли две транзакции, выполняющие единственную команду UPDATE одной и той же таблицы (без where), заблокировать друг друга?  
>Попробуйте воспроизвести такую ситуацию.  
